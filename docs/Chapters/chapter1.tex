\chapter{Preliminaria}
Aby zrozumieć jak działa dostarczony serwer, należy wpierw zrozumieć architekturę rozszerzenia w systemie edytora Visual Studio Code, a także na czym polega omawiany protokół. W tym rozdziale poruszone zostaną:

\begin{itemize}
    \item Struktura wtyczki rozszerzającej działanie edytora.
    \item Opis protokołu LSP.
    \item Visual Studio a Visual Studio Code
\end{itemize}

\section{Struktura rozszerzenia Visual Studio Code}
Sercem każdego rozszerzenia jest plik \texttt{package.json}, który przechowuje informacje na temat autora pakietu, warunki jego uruchomienia, a także wszystkie jego zależności:

\begin{lstlisting}
    {
        "name": "lua-lang",
        "description": "Lua language support",
        "author": "Wiktor Adamski",
        "license": "MIT",
        "version": "0.0.1",
        "engines": {
            "vscode": "^1.16.0"
        },
        "categories": [
            "Languages"
        ],
        "activationEvents": [
            "onLanguage:lua"
        ],
        "main": "./out/src/extension",
        "contributes": {
            "languages": [
                {
                    "id": "lua",
                    "aliases": [
                        "Lua",
                        "lua"
                    ],
                    "extensions": [
                        ".lua",
                        ".p8",
                        ".rockspec"
                    ],
                    "configuration": "./language-configuration.json"
                }
            ],
        },
        "dependencies": {
            "vscode": "^1.1.5",
            "vscode-languageclient": "^3.4.2"
        }
    }
\end{lstlisting}

O ile serwer LSP może być napisany w dowolnym języku, część bezpośrednio łącząca się z edytorem (aktualna wtyczka) musi być w języku JavaScript dla środowiska uruchomieniowego node.js. 

Duża część kodu który jest wspólny dla wszystkich rozszerzeń jest możliwa do automatycznego stworzenia przez generator kodu Yeoman. Proste polecenie \texttt{yo code} przeprowadzi nas przez kreator wtyczek i utworzy dodatkowe pliki konfiguracyjne, które pozwolą korzystać z edytora VS Code jako środowiska developerskiego.

\section{Protokół Language Server Protocol}
Protokół LSP jest specjalizacją protokołu JSON-RPC, który przesyła dane między stronami komunikacji za pomocą obiektów JSON. Pierwszą wiadomością w trakcie połączenia jest wymiana możliwości zarówno klienta (np. czy edytor wspiera przemianowanie zmiennej), jak i serwera (np. wskazanie definicji danego symbolu, czy automatyczne uzupełnianie pisanego tekstu). Poniżej przedstawiam przykładowe zapytanie klienta:

\begin{lstlisting}
    {
        "jsonrpc": "2.0",
        "id": 1,
        "method": "textDocument/didOpen",
        "params": {
            ...
        }
    }
\end{lstlisting}

\section{Visual Studio (Code)}
Wiele osób nie rozróżnia od siebie dwóch produktów Microsoftu. Visual Studio to zintegrowane środowisko programistyczne, nastawione głównie na pisanie programów w języku C\#. Visual Studio Code jest natomiast otwartoźródłowym edytorem kodu opartym na silniku renderującym Electron od firmy Github, co sprawia, że jest on dosyć podobny do edytora Atom (również pod względem metodologii wtyczek). 
